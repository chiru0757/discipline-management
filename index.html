<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Discipline Management System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

<style>
*{font-family:Poppins;box-sizing:border-box}
body{margin:0;background:#0f172a;color:#fff;padding:20px}
.hidden{display:none}
.card{background:#1e293b;padding:20px;border-radius:12px;margin-bottom:15px}
input,select,button{
  width:100%;padding:10px;margin:6px 0;border-radius:6px;border:none
}
button{background:#22c55e;font-weight:600;cursor:pointer}
button:hover{background:#16a34a}
.logout{background:#ef4444}
nav button{margin-bottom:8px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #334155;padding:6px;text-align:center}
th{background:#334155}
.summary span{
  display:inline-block;background:#2563eb;padding:6px;margin:4px;border-radius:6px
}
.search{background:#020617;color:#fff;border:1px solid #334155}
</style>
</head>

<body>

<h2 align="center">ðŸ“˜ Discipline Management System</h2>

<!-- LOGIN PAGE -->
<div class="card" id="loginPage">
  <h3>Login</h3>
  <select id="role">
    <option value="admin">Admin</option>
    <option value="teacher">Teacher</option>
    <option value="student">Student</option>
  </select>
  <input id="username" placeholder="Username / Student ID">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- ADMIN / TEACHER DASHBOARD -->
<div id="staffPage" class="hidden">
  <nav class="card">
    <button onclick="showPage('addPage')">âž• Add Record</button>
    <button onclick="showPage('viewPage')">ðŸ“‹ View Records</button>
    <button class="logout" onclick="logout()">Logout</button>
  </nav>
</div>

<!-- ADD RECORD PAGE -->
<div id="addPage" class="hidden card">
  <h3>Add Discipline Record</h3>
  <select id="course"></select>
  <select id="student"></select>
  <select id="issue">
    <option>Uniform Violation</option>
    <option>Mobile Phone Usage</option>
    <option>Late Coming</option>
    <option>Misbehavior</option>
    <option>ID Card Missing</option>
    <option>Class Bunking</option>
  </select>
  <input type="date" id="date">
  <button onclick="saveRecord()">Save</button>
</div>

<!-- VIEW RECORDS PAGE -->
<div id="viewPage" class="hidden card">
  <h3>All Discipline Records</h3>
  <input class="search" placeholder="Search..." oninput="loadRecords(this.value)">
  <div class="summary" id="summary"></div>
  <button onclick="exportExcel()">Export Excel</button>
  <button onclick="window.print()">Export PDF</button>
  <table>
    <thead>
      <tr><th>Course</th><th>Student</th><th>Issue</th><th>Date</th></tr>
    </thead>
    <tbody id="records"></tbody>
  </table>
</div>

<!-- STUDENT DASHBOARD -->
<div id="studentPage" class="hidden card">
  <h3>Student Dashboard</h3>
  <button onclick="showPage('historyPage')">ðŸ“˜ My Discipline History</button>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<!-- STUDENT HISTORY PAGE -->
<div id="historyPage" class="hidden card">
  <h3>My Discipline History</h3>
  <input class="search" placeholder="Search issue/date" oninput="loadStudent(this.value)">
  <div class="summary" id="studentSummary"></div>
  <table>
    <thead><tr><th>Issue</th><th>Date</th></tr></thead>
    <tbody id="studentRecords"></tbody>
  </table>
</div>

<script>
// USERS
const users=[
  {u:"admin",p:"admin123",r:"admin"},
  {u:"teacher",p:"teach123",r:"teacher"}
];

// STUDENTS
const students={BCA:[],BBA:[],BCOM:[]};
["BCA","BBA","BCOM"].forEach(c=>{
  for(let i=1;i<=80;i++)
    students[c].push(c+"-"+String(i).padStart(2,"0"));
});

// INIT COURSE/STUDENTS
course.innerHTML=Object.keys(students).map(c=>`<option>${c}</option>`).join("");
course.onchange=()=>student.innerHTML=students[course.value].map(s=>`<option>${s}</option>`).join("");
course.onchange();

let currentStudent="";

// LOGIN
function login(){
  const r=role.value,u=username.value,p=password.value;

  if(r==="student"){
    currentStudent=u;
    showPage("studentPage");
    return;
  }

  if(users.find(x=>x.u===u && x.p===p && x.r===r)){
    showPage("staffPage");
  } else alert("Invalid Login");
}

// NAVIGATION
function showPage(id){
  document.querySelectorAll("body > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// SAVE RECORD
function saveRecord(){
  if(!date.value){alert("Select date");return;}
  const data=JSON.parse(localStorage.getItem("discipline")||"[]");
  data.push({course:course.value,student:student.value,issue:issue.value,date:date.value});
  localStorage.setItem("discipline",JSON.stringify(data));
  alert("Record Saved");
}

// LOAD STAFF RECORDS
function loadRecords(q=""){
  q=q.toLowerCase();
  const data=JSON.parse(localStorage.getItem("discipline")||"[]");
  records.innerHTML="";
  const count={};

  data.filter(r=>
    r.course.toLowerCase().includes(q) ||
    r.student.toLowerCase().includes(q) ||
    r.issue.toLowerCase().includes(q) ||
    r.date.includes(q)
  ).forEach(r=>{
    records.innerHTML+=`<tr><td>${r.course}</td><td>${r.student}</td><td>${r.issue}</td><td>${r.date}</td></tr>`;
    count[r.issue]=(count[r.issue]||0)+1;
  });

  summary.innerHTML=Object.entries(count).map(i=>`<span>${i[0]}: ${i[1]}</span>`).join("");
}

// LOAD STUDENT HISTORY
function loadStudent(q=""){
  q=q.toLowerCase();
  const data=JSON.parse(localStorage.getItem("discipline")||"[]").filter(r=>r.student===currentStudent);
  studentRecords.innerHTML="";
  const count={};

  data.filter(r=>r.issue.toLowerCase().includes(q)||r.date.includes(q))
    .forEach(r=>{
      studentRecords.innerHTML+=`<tr><td>${r.issue}</td><td>${r.date}</td></tr>`;
      count[r.issue]=(count[r.issue]||0)+1;
    });

  studentSummary.innerHTML=Object.entries(count).map(i=>`<span>${i[0]}: ${i[1]}</span>`).join("");
}

// EXPORT
function exportExcel(){
  const d=JSON.parse(localStorage.getItem("discipline")||"[]");
  let csv="Course,Student,Issue,Date\n";
  d.forEach(r=>csv+=`${r.course},${r.student},${r.issue},${r.date}\n`);
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="discipline_records.csv";
  a.click();
}

function logout(){location.reload();}
</script>

</body>
</html>

