<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Discipline Management System</title>

<!-- PDF & Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
/* BODY & PAGE */
body{
 margin:0;
 font-family:Segoe UI,sans-serif;
 background:linear-gradient(135deg,#1f4037,#99f2c8);
}
.page{
 max-width:1200px;
 margin:30px auto;
 background:#fff;
 padding:25px;
 border-radius:12px;
 box-shadow:0 20px 40px rgba(0,0,0,.4);
}
.hidden{display:none}

/* HEADINGS */
h2,h3{text-align:center;color:#1f4037;margin-bottom:15px;}

/* INPUTS & BUTTONS */
input,select,button{
 padding:10px;
 margin:6px 0;
 border-radius:6px;
 border:1px solid #ccc;
 font-size:16px;
}
button{
 background:#1f4037;
 color:#fff;
 border:none;
 cursor:pointer;
 transition:0.2s;
}
button:hover{background:#16342d}
.back{background:#777}
.danger{background:#c0392b}
.danger:hover{background:#962d22}

/* GRID & CARDS */
.grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
 gap:15px;
 margin-bottom:30px;
}
.card{
 background:#e6f5ef;
 padding:25px;
 border-radius:12px;
 text-align:center;
 font-weight:bold;
 font-size:18px;
 cursor:pointer;
 box-shadow:0 5px 15px rgba(0,0,0,.2);
 transition: transform .2s, background .2s;
}
.card:hover{
 background:#cdeee4;
 transform: translateY(-5px);
}

/* STAT BOX */
.stat{
 background:#e6f5ef;
 padding:20px;
 border-radius:12px;
 text-align:center;
 font-size:18px;
 box-shadow:0 5px 15px rgba(0,0,0,.2);
 transition: transform .2s;
}
.stat:hover{
 transform: translateY(-5px);
}

/* TABLES */
table{
 width:100%;
 border-collapse:collapse;
 margin-top:15px;
 font-size:16px;
}
th,td{
 border:1px solid #ccc;
 padding:10px;
 text-align:center;
}
th{background:#1f4037;color:#fff}

/* ACTIONS */
.actions{
 text-align:center;
 margin:20px 0;
}

/* SEARCH BOX */
#search{
 width:100%;
 max-width:400px;
 margin:0 auto 15px auto;
 display:block;
 padding:10px;
 border-radius:6px;
 border:1px solid #ccc;
 font-size:16px;
}

/* LOGIN PAGE CENTERED */
#loginPage{
 text-align:center;
}
#loginPage input,#loginPage select,#loginPage button{
 width:80%;
 max-width:300px;
 display:block;
 margin:10px auto;
}
#msg{margin-top:10px;color:red;}

/* RESPONSIVE TABLE SCROLL */
table{overflow-x:auto; display:block;}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="page" id="loginPage">
<h2>Discipline Management Login</h2>
<select id="role">
 <option>Admin</option>
 <option>Teacher</option>
 <option>Student</option>
</select>
<input id="uid" placeholder="Login ID">
<input id="pwd" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="msg"></p>
</div>

<!-- DASHBOARD -->
<div class="page hidden" id="dashboard">
<button class="back" onclick="back()">â¬… Back</button>
<h2>Dashboard</h2>

<div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr))">
 <div class="stat">
  <h3>Total Discipline Issues</h3>
  <b id="total">0</b>
 </div>
</div>

<h3>Manage Discipline</h3>
<div class="grid">
 <div class="card" onclick="openCourse('BCA')">BCA</div>
 <div class="card" onclick="openCourse('BCOM')">BCOM</div>
 <div class="card" onclick="openCourse('BBA')">BBA</div>
</div>

<h3>Records</h3>
<div class="grid">
 <div class="card" onclick="viewAllRecords()">ðŸ“‹ View All Records</div>
</div>
</div>

<!-- YEAR PAGE -->
<div class="page hidden" id="yearPage">
<button class="back" onclick="back()">â¬… Back</button>
<h3 id="yearTitle"></h3>
<div class="grid">
 <div class="card" onclick="openYear(1)">1st Year</div>
 <div class="card" onclick="openYear(2)">2nd Year</div>
 <div class="card" onclick="openYear(3)">3rd Year</div>
</div>
</div>

<!-- STUDENTS PAGE -->
<div class="page hidden" id="studentPage">
<button class="back" onclick="back()">â¬… Back</button>
<h3>Students</h3>
<input id="search" placeholder="Search by Name or UUCMS" onkeyup="searchStudents()">
<table>
<thead>
<tr>
<th>UUCMS</th>
<th>Name</th>
<th>Issue</th>
<th>Save</th>
</tr>
</thead>
<tbody id="studentsTable"></tbody>
</table>
</div>

<!-- ALL RECORDS PAGE -->
<div class="page hidden" id="allRecordsPage">
<button class="back" onclick="back()">â¬… Back</button>
<h3>All Discipline Records</h3>

<div class="actions">
 <button onclick="downloadPDF()">ðŸ“„ Download PDF</button>
 <button onclick="downloadExcel()">ðŸ“Š Download Excel</button>
 <button class="danger" onclick="deleteAll()" id="delAll">ðŸ—‘ Delete All</button>
</div>

<div style="display:flex; gap:20px; flex-wrap:wrap;">

  <!-- SIDEBAR -->
  <div id="issueSummary" style="flex:1; min-width:200px; background:#e6f5ef; padding:15px; border-radius:12px;">
    <h3>Issue Summary</h3>
    <ul id="issueList" style="list-style:none; padding:0; font-size:16px;"></ul>
    <hr>
    <b>Total Issues: <span id="totalIssues">0</span></b>
  </div>

  <!-- TABLE -->
  <div style="flex:3; min-width:400px;">
    <table>
      <thead>
        <tr>
          <th>UUCMS</th>
          <th>Name</th>
          <th>Issue</th>
          <th>Date & Time</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody id="allRecordsTable"></tbody>
    </table>
  </div>

</div>
</div>

<script>
/* USERS & DATA */
const users=[
 {id:"admin",pass:"admin123"},
 {id:"teacher",pass:"teacher123"},
 {id:"student",pass:"student123"}
];
const issues=["Uniform Violation","Late Arrival","Mobile Usage","ID Card Missing","Misconduct","Unauthorized Absence","Classroom Disturbance"];
const names=["Aarav","Ananya","Rohan","Sneha","Karthik","Pooja","Rahul","Nisha","Vivek","Divya"];

let stack=[],course="",year=0,userRole="";
let students=[], records=JSON.parse(localStorage.getItem("records")||"[]");

/* NAVIGATION */
function show(p){document.querySelectorAll(".page").forEach(x=>x.classList.add("hidden")); p.classList.remove("hidden")}
function push(p){stack.push(p); show(p)}
function back(){stack.pop(); show(stack.at(-1)||document.getElementById("loginPage"));}

/* LOGIN */
function login(){
 const uidInput=document.getElementById("uid").value;
 const pwdInput=document.getElementById("pwd").value;
 const u=users.find(x=>x.id===uidInput && x.pass===pwdInput);
 if(!u){document.getElementById("msg").innerText="Invalid credentials"; return;}
 userRole=u.id;
 document.getElementById("total").innerText=records.length;
 stack=[document.getElementById("loginPage")];
 push(document.getElementById("dashboard"));
 document.getElementById("msg").innerText="";
}

/* COURSES */
function openCourse(c){course=c; document.getElementById("yearTitle").innerText=c+" - Select Year"; push(document.getElementById("yearPage"))}
function openYear(y){year=y; generateStudents(); push(document.getElementById("studentPage"))}

/* STUDENTS */
function generateStudents(){
 students=[];
 for(let i=1;i<=80;i++){
  students.push({uucms:course+year+String(i).padStart(3,"0"),name:names[i%names.length]+" "+names[(i+2)%names.length]});
 }
 renderStudents(students);
}
function renderStudents(list){
 const tbody=document.getElementById("studentsTable"); tbody.innerHTML="";
 list.forEach((s,i)=>{
  tbody.innerHTML+=`<tr>
   <td>${s.uucms}</td>
   <td>${s.name}</td>
   <td><select id="iss${i}">${issues.map(x=>`<option>${x}</option>`).join("")}</select></td>
   <td><button ${userRole==="student"?"disabled":""} onclick="save('${s.uucms}','${s.name}','iss${i}')">Save</button></td>
  </tr>`;
 });
}
function searchStudents(){
 const q=document.getElementById("search").value.toLowerCase();
 renderStudents(students.filter(s=>s.uucms.toLowerCase().includes(q) || s.name.toLowerCase().includes(q)));
}

/* SAVE */
function save(u,n,i){
 if(!confirm("Save discipline record?")) return;
 records.push({uucms:u,name:n,issue:document.getElementById(i).value,time:new Date().toLocaleString()});
 localStorage.setItem("records",JSON.stringify(records));
 document.getElementById("total").innerText=records.length;
 updateIssueSummary(); // dynamic update
 alert("Record Saved");
}

/* ALL RECORDS */
function viewAllRecords(){
 document.getElementById("delAll").style.display=userRole==="student"?"none":"inline-block";
 renderAllRecords();
 push(document.getElementById("allRecordsPage"));
}

/* RENDER TABLE + SIDEBAR */
function renderAllRecords(){
 const tbody = document.getElementById("allRecordsTable"); tbody.innerHTML = "";
 if(records.length===0){
    tbody.innerHTML="<tr><td colspan='5'>No Records Found</td></tr>";
    document.getElementById("issueList").innerHTML = "";
    document.getElementById("totalIssues").innerText = 0;
    document.getElementById("total").innerText = 0;
    return;
 }
 // Table
 records.forEach((r,i)=>{
   tbody.innerHTML += `<tr>
        <td>${r.uucms}</td><td>${r.name}</td><td>${r.issue}</td><td>${r.time}</td>
        <td><button class="danger" ${userRole==="student"?"disabled":""} onclick="deleteOne(${i})">Delete</button></td>
      </tr>`;
 });

 updateIssueSummary();
}

/* UPDATE SIDEBAR COUNTS */
function updateIssueSummary(){
 const issueCount = {};
 records.forEach(r => { issueCount[r.issue] = (issueCount[r.issue]||0)+1; });

 const issueList = document.getElementById("issueList");
 issueList.innerHTML = "";
 for(const [issue,count] of Object.entries(issueCount)){
   issueList.innerHTML += `<li>${issue}: ${count}</li>`;
 }

 document.getElementById("totalIssues").innerText = records.length;
 document.getElementById("total").innerText = records.length;
}

/* DELETE */
function deleteOne(i){if(!confirm("Delete this record?"))return; records.splice(i,1); localStorage.setItem("records",JSON.stringify(records)); renderAllRecords();}
function deleteAll(){if(!confirm("Delete ALL records?"))return; records=[]; localStorage.removeItem("records"); renderAllRecords();}

/* PDF & EXCEL */
function downloadPDF(){
 const {jsPDF}=window.jspdf; const pdf=new jsPDF();
 pdf.text("Discipline Records",10,10);
 let y=20; records.forEach(r=>{pdf.text(`${r.uucms} | ${r.name} | ${r.issue} | ${r.time}`,10,y); y+=8;});
 pdf.save("discipline_records.pdf");
}
function downloadExcel(){
 const ws=XLSX.utils.json_to_sheet(records);
 const wb=XLSX.utils.book_new();
 XLSX.utils.book_append_sheet(wb,ws,"Records");
 XLSX.writeFile(wb,"discipline_records.xlsx");
}

/* TOUCH SWIPE BACK */
let sx=0;
document.addEventListener("touchstart",e=>sx=e.touches[0].clientX);
document.addEventListener("touchend",e=>{if(e.changedTouches[0].clientX-sx>80) back();});
</script>

</body>
</html>
