<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Discipline Management System</title>

<!-- PDF & Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{font-family:Segoe UI;background:#eef2f7;margin:0}
header{background:#1e293b;color:#fff;padding:15px;text-align:center}
.box{background:#fff;max-width:1100px;margin:20px auto;padding:20px;border-radius:10px;box-shadow:0 10px 20px rgba(0,0,0,.1)}
h3{text-align:center;color:#1e293b}
input,select,button{padding:8px;margin:5px}
button{background:#2563eb;color:#fff;border:none;border-radius:5px;cursor:pointer}
button:hover{background:#1e40af}
button.danger{background:#dc2626}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#334155;color:#fff}
.hidden{display:none}
.center{text-align:center}
</style>
</head>

<body>

<header>
<h2>Discipline Management System</h2>
</header>

<!-- LOGIN -->
<div class="box" id="loginBox">
<h3>Login</h3>
<select id="role">
<option value="admin">Admin</option>
<option value="student">Student</option>
</select><br>
<input id="username" placeholder="Username / Reg No"><br>
<input id="password" type="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
</div>

<!-- ADMIN HOME -->
<div class="box hidden" id="adminHome">
<h3>CLASS AND SECTION</h3>
<div class="center">
<button onclick="openClass('BCA A')">BCA A</button>
<button onclick="openClass('BCA B')">BCA B</button>
<button onclick="openClass('BCA C')">BCA C</button><br><br>
<button onclick="openRecords()">ðŸ“„ View Saved Records</button>
<button onclick="logout()">Logout</button>
</div>
</div>

<!-- STUDENTS ENTRY -->
<div class="box hidden" id="studentBox">
<h3 id="classTitle"></h3>
<table>
<thead>
<tr>
<th>Reg No</th>
<th>Student Name</th>
<th>Issue</th>
<th>Save</th>
</tr>
</thead>
<tbody id="studentTable"></tbody>
</table>
<button onclick="back()">â¬… Back</button>
</div>

<!-- RECORDS -->
<div class="box hidden" id="recordBox">
<h3>Saved Discipline Records</h3>
<button onclick="exportPDF()">PDF</button>
<button onclick="exportExcel()">Excel</button>
<button onclick="back()">â¬… Back</button>
<table>
<thead>
<tr>
<th>Class</th>
<th>Reg No</th>
<th>Name</th>
<th>Issue</th>
<th>Date & Time</th>
<th>Action</th>
</tr>
</thead>
<tbody id="recordTable"></tbody>
</table>
</div>

<!-- STUDENT VIEW -->
<div class="box hidden" id="studentView">
<h3>Your Discipline Records</h3>
<table>
<thead>
<tr>
<th>Class</th>
<th>Issue</th>
<th>Date & Time</th>
</tr>
</thead>
<tbody id="studentRecords"></tbody>
</table>
<button onclick="logout()">Logout</button>
</div>

<script>
let currentClass="";
let records = JSON.parse(localStorage.getItem("records")) || [];
let loggedStudent="";

/* LOGIN */
function login(){
  let u=username.value.trim();
  let p=password.value.trim();
  let r=role.value;

  if(r==="admin"){
    if(u==="RNSFGC" && p==="rns@1234"){
      loginBox.classList.add("hidden");
      adminHome.classList.remove("hidden");
    } else alert("Invalid Admin Credentials");
  } else {
    if(p==="student123"){
      loggedStudent=u;
      loginBox.classList.add("hidden");
      studentView.classList.remove("hidden");
      loadStudentRecords();
    } else alert("Invalid Student Credentials");
  }
}

/* ADMIN STUDENTS */
function openClass(cls){
  currentClass=cls;
  adminHome.classList.add("hidden");
  studentBox.classList.remove("hidden");
  classTitle.innerText=cls+" Students";
  studentTable.innerHTML="";

  for(let i=1;i<=40;i++){
    let reg=cls.replace(" ","").toUpperCase()+ (100+i);
    studentTable.innerHTML+=`
    <tr>
      <td>${reg}</td>
      <td>${cls} Student ${i}</td>
      <td>
        <select id="issue_${reg}">
          <option value="">Select</option>
          <option>Haircut</option>
          <option>Uniform</option>
          <option>Shoes</option>
          <option>Late Coming</option>
          <option>Mobile Usage</option>
        </select>
      </td>
      <td><button onclick="saveRecord('${reg}','${cls} Student ${i}')">Save</button></td>
    </tr>`;
  }
}

/* SAVE */
function saveRecord(reg,name){
  let issue=document.getElementById("issue_"+reg).value;
  if(!issue){alert("Select issue");return;}
  records.push({
    class:currentClass,
    reg,name,issue,
    time:new Date().toLocaleString()
  });
  localStorage.setItem("records",JSON.stringify(records));
  alert("Saved Successfully");
}

/* RECORDS */
function openRecords(){
  adminHome.classList.add("hidden");
  recordBox.classList.remove("hidden");
  loadRecords();
}

function loadRecords(){
  recordTable.innerHTML="";
  records.forEach((r,i)=>{
    recordTable.innerHTML+=`
    <tr>
      <td>${r.class}</td>
      <td>${r.reg}</td>
      <td>${r.name}</td>
      <td>${r.issue}</td>
      <td>${r.time}</td>
      <td><button class="danger" onclick="del(${i})">Delete</button></td>
    </tr>`;
  });
}

function del(i){
  if(confirm("Delete record?")){
    records.splice(i,1);
    localStorage.setItem("records",JSON.stringify(records));
    loadRecords();
  }
}

/* STUDENT VIEW */
function loadStudentRecords(){
  studentRecords.innerHTML="";
  records.filter(r=>r.reg===loggedStudent).forEach(r=>{
    studentRecords.innerHTML+=`
    <tr>
      <td>${r.class}</td>
      <td>${r.issue}</td>
      <td>${r.time}</td>
    </tr>`;
  });
}

/* EXPORT */
function exportPDF(){
  const {jsPDF}=window.jspdf;
  let doc=new jsPDF();
  let y=10;
  doc.text("Discipline Records",10,y);y+=10;
  records.forEach(r=>{
    doc.text(`${r.class} | ${r.reg} | ${r.name} | ${r.issue} | ${r.time}`,10,y);
    y+=8;
  });
  doc.save("records.pdf");
}

function exportExcel(){
  let ws=XLSX.utils.json_to_sheet(records);
  let wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Records");
  XLSX.writeFile(wb,"records.xlsx");
}

/* NAV */
function back(){
  studentBox.classList.add("hidden");
  recordBox.classList.add("hidden");
  adminHome.classList.remove("hidden");
}

function logout(){
  location.reload();
}
</script>

</body>
</html>
